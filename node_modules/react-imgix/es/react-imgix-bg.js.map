{"version":3,"file":"react-imgix-bg.js","names":["React","withContentRect","shallowEqual","PACKAGE_VERSION","constructUrl","extractQueryParams","findClosest","targetWidths","mergeComponentPropsHOF","processPropsHOF","findNearestWidth","actualWidth","toFixed","dp","value","__shouldComponentUpdate","props","nextProps","contentRect","bounds","prevWidth","width","prevHeight","height","nextContentRect","nextBounds","nextWidth","nextHeight","customizer","oldProp","newProp","key","a","b","Array","isArray","undefined","propsEqual","BackgroundImpl","_React$Component","_inherits","_super","_createSuper","_classCallCheck","call","_createClass","shouldComponentUpdate","render","_this$props","measureRef","_this$props$imgixPara","imgixParams","onLoad","disableLibraryParam","disablePathEncoding","src","children","_this$props$className","className","forcedWidth","w","forcedHeight","h","hasDOMDimensions","htmlAttributes","dpr","global","devicePixelRatio","ref","onRef","el","_ref","bothWidthAndHeightPassed","ar","neitherWidthNorHeightPassed","Math","ceil","isReady","commonProps","_objectSpread","createElement","_extends","concat","renderedSrc","_extractQueryParams","_extractQueryParams2","_slicedToArray","rawSrc","params","longImgixParams","fit","ixlib","srcOptions","style","backgroundImage","backgroundSize","Component","Background","__BackgroundImpl"],"sources":["../src/react-imgix-bg.jsx"],"sourcesContent":["import React from \"react\";\nimport { withContentRect } from \"react-measure\";\nimport { shallowEqual } from \"./common\";\nimport { PACKAGE_VERSION } from \"./constants\";\nimport constructUrl from \"./constructUrl\";\nimport extractQueryParams from \"./extractQueryParams\";\nimport findClosest from \"./findClosest\";\nimport targetWidths from \"./targetWidths\";\nimport { mergeComponentPropsHOF, processPropsHOF } from \"./HOFs\";\n\nconst findNearestWidth = (actualWidth) =>\n  findClosest(actualWidth, targetWidths);\n\nconst toFixed = (dp, value) => +value.toFixed(dp);\n\nexport const __shouldComponentUpdate = (props, nextProps) => {\n  const contentRect = props.contentRect;\n  const bounds = contentRect.bounds;\n  const { width: prevWidth, height: prevHeight } = bounds;\n\n  const nextContentRect = nextProps.contentRect;\n  const nextBounds = nextContentRect.bounds;\n  const { width: nextWidth, height: nextHeight } = nextBounds;\n\n  // If neither of the previous nor next dimensions are present,\n  // re-render.\n  if (!nextWidth || !nextHeight || !prevWidth || !prevHeight) {\n    return true;\n  }\n\n  // The component has been rendered at least twice by this point\n  // and both the previous and next dimensions should be defined.\n  // Only update if the nextWidth is greater than the prevWidth.\n  if (prevWidth && nextWidth && nextWidth > prevWidth) {\n    return true;\n  }\n\n  // Similarly, only update if the next height is greater than\n  // the previous height.\n  if (prevHeight && nextHeight && nextHeight > prevHeight) {\n    return true;\n  }\n\n  const customizer = (oldProp, newProp, key) => {\n    // these keys are ignored from prop checking process\n    if (key === \"contentRect\" || key === \"measure\" || key === \"measureRef\") {\n      return true;\n    }\n\n    if (key === \"children\") {\n      return oldProp == newProp;\n    }\n\n    if (key === \"imgixParams\") {\n      return shallowEqual(oldProp, newProp, (a, b) => {\n        if (Array.isArray(a)) {\n          return shallowEqual(a, b);\n        }\n        return undefined;\n      });\n    }\n\n    if (key === \"htmlAttributes\") {\n      return shallowEqual(oldProp, newProp);\n    }\n\n    return undefined; // handled by shallowEqual\n  };\n\n  // If we made it here, we need to check if the \"top-level\"\n  // props have changed (e.g. disableLibraryParam).\n  const propsEqual = shallowEqual(props, nextProps, customizer);\n\n  return !propsEqual;\n};\n\nclass BackgroundImpl extends React.Component {\n  constructor(props) {\n    super(props);\n  }\n\n  shouldComponentUpdate(nextProps) {\n    return __shouldComponentUpdate(this.props, nextProps);\n  }\n\n  render() {\n    const {\n      measureRef,\n      contentRect,\n      imgixParams = {},\n      onLoad,\n      disableLibraryParam,\n      disablePathEncoding,\n      src,\n      children,\n      className = \"\",\n    } = this.props;\n    const { w: forcedWidth, h: forcedHeight } = imgixParams;\n    const hasDOMDimensions =\n      contentRect.bounds.width != null && contentRect.bounds.height != null;\n    const htmlAttributes = this.props.htmlAttributes || {};\n    const dpr = toFixed(2, imgixParams.dpr || global.devicePixelRatio || 1);\n    const ref = htmlAttributes.ref;\n    const onRef = (el) => {\n      measureRef(el);\n      if (typeof ref === \"function\") {\n        ref(el);\n      }\n    };\n\n    const { width, height } = (() => {\n      const bothWidthAndHeightPassed =\n        forcedWidth != null && forcedHeight != null;\n\n      if (bothWidthAndHeightPassed) {\n        return { width: forcedWidth, height: forcedHeight };\n      }\n\n      if (!hasDOMDimensions) {\n        return { width: undefined, height: undefined };\n      }\n      const ar = contentRect.bounds.width / contentRect.bounds.height;\n\n      const neitherWidthNorHeightPassed =\n        forcedWidth == null && forcedHeight == null;\n      if (neitherWidthNorHeightPassed) {\n        const width = findNearestWidth(contentRect.bounds.width);\n        const height = Math.ceil(width / ar);\n        return { width, height };\n      }\n      if (forcedWidth != null) {\n        const height = Math.ceil(forcedWidth / ar);\n        return { width: forcedWidth, height };\n      } else if (forcedHeight != null) {\n        const width = Math.ceil(forcedHeight * ar);\n        return { width, height: forcedHeight };\n      }\n    })();\n    const isReady = width != null && height != null;\n\n    const commonProps = {\n      ...htmlAttributes,\n    };\n\n    if (!isReady) {\n      return (\n        <div\n          {...commonProps}\n          className={`react-imgix-bg-loading ${className}`}\n          ref={onRef}\n        >\n          {children}\n        </div>\n      );\n    }\n\n    const renderedSrc = (() => {\n      const [rawSrc, params] = extractQueryParams(src);\n      const longImgixParams = {\n        ...params,\n        fit: \"crop\",\n        ...imgixParams,\n        ...(disableLibraryParam ? {} : { ixlib: `react-${PACKAGE_VERSION}` }),\n        width,\n        height,\n        dpr,\n      };\n\n      const srcOptions = {\n        disablePathEncoding,\n      }\n\n      return constructUrl(rawSrc, longImgixParams, srcOptions);\n    })();\n\n    const style = {\n      ...htmlAttributes.style,\n      backgroundImage: `url(${renderedSrc})`,\n      backgroundSize:\n        (htmlAttributes.style || {}).backgroundSize !== undefined\n          ? htmlAttributes.style.backgroundSize\n          : \"cover\",\n    };\n\n    return (\n      <div {...commonProps} className={className} ref={onRef} style={style}>\n        {children}\n      </div>\n    );\n  }\n}\n\nconst Background = mergeComponentPropsHOF(\n  processPropsHOF(withContentRect(\"bounds\")(BackgroundImpl))\n);\n\nexport { Background, BackgroundImpl as __BackgroundImpl };\n"],"mappings":"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"}