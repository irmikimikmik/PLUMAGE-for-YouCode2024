import React from "react";
import { fireEvent, render } from "@testing-library/react";
import { Video } from "./Video";
import "@testing-library/jest-dom";

describe("Video", () => {
  const video = {
    videoSrc: "//youtube.com/embed/93WhCcpvDdU?autoplay=1",
    isAutoPlayed: false,
    isMuted: false,
    videoThumbnail: {
      title: "Video title",
      subtitle: "Video subtitle",
      isPlayButtonEnabled: true,
      playButtonColour: "#FFFFFF",
      textColour: "#FFFFFF",
      isThumbnailGradientEnabled: false,
      image: {
        src: "https://images-dynamic-arcteryx.imgix.net/campaign/S23/ski-snow/assets/images/panel10_desktop_arcteryx-ski-snow-hub-goggles.jpg?fit=crop&h=1191&w=1055&q=45&fm=webp",
        alt: "How to wash your GORE-TEX",
      },
    },
  };

  it("should render the video cover image and play button", () => {
    const { getByAltText, getByTitle } = render(
      <Video
        videoSrc={video.videoSrc}
        isAutoPlayed={video.isAutoPlayed}
        isMuted={video.isMuted}
        videoThumbnail={video.videoThumbnail}
      />,
    );

    const coverImage = getByAltText("How to wash your GORE-TEX");
    expect(coverImage).toBeInTheDocument();
    expect(coverImage).toHaveAttribute(
      "src",
      "https://images-dynamic-arcteryx.imgix.net/campaign/S23/ski-snow/assets/images/panel10_desktop_arcteryx-ski-snow-hub-goggles.jpg?fit=crop&h=1191&w=1055&q=45&fm=webp",
    );

    const playButton = getByTitle("Play button");
    expect(playButton).toBeInTheDocument();
  });

  it("should show the video modal when the VideoWrapper is clicked", () => {
    const { getByTestId, getByRole } = render(
      <Video
        videoSrc={video.videoSrc}
        isAutoPlayed={video.isAutoPlayed}
        isMuted={video.isMuted}
        videoThumbnail={video.videoThumbnail}
      />,
    );

    const videoWrapper = getByTestId("video-wrapper");
    expect(videoWrapper).toBeInTheDocument();

    fireEvent.click(videoWrapper);

    const modal = getByRole("dialog");
    expect(modal).toBeInTheDocument();
  });
});
