import React, { useState } from "react";
import { Modal } from "@arcteryx/components-modal";
import { type VideoProps } from "./Video.types";
import { VideoThumbnail } from "../../molecules/videoThumbnail";
import { VideoIframe } from "../../atoms";
import styled from "styled-components";

const StyledVideoWrapper = styled.div`
  width: 100%;
  height: 100%;
`;

export const Video: React.FC<VideoProps> = ({
  videoSrc,
  isAutoPlayed = false,
  isMuted = true,
  videoThumbnail,
}) => {
  const [isModalShown, setIsModalShown] = useState(false);
  const [modalCaller, setModalCaller] = useState<EventTarget | null>(null);

  const callModal = (event: React.MouseEvent<HTMLButtonElement>): void => {
    setModalCaller(event.currentTarget);
    setIsModalShown(!isModalShown);
  };

  const {
    title,
    subtitle,
    isPlayButtonEnabled,
    playButtonColour,
    textColour,
    isThumbnailGradientEnabled,
    image,
  } = videoThumbnail;

  if (videoSrc === "" || (image != null && image.src === "")) {
    return null;
  }

  return (
    <StyledVideoWrapper>
      <VideoThumbnail
        title={title}
        subtitle={subtitle}
        isPlayButtonEnabled={isPlayButtonEnabled}
        playButtonColour={playButtonColour}
        textColour={textColour}
        isThumbnailGradientEnabled={isThumbnailGradientEnabled}
        image={image}
        onClickHandler={callModal}
      />
      <Modal
        modalIsShown={isModalShown}
        toggleModal={setIsModalShown}
        modalCaller={modalCaller}
        video={true}
        extraClassName="modal--video"
      >
        <VideoIframe
          url={videoSrc}
          isAutoPlayed={isAutoPlayed}
          isMuted={isMuted}
        />
      </Modal>
    </StyledVideoWrapper>
  );
};
